---
title: Refun-20241008
pubDate: 2024-10-08
tags: [ðŸ¡Refun]
---

ä»Šå¤©å±•ç¤ºä¸€ä¸‹[Rust `impl Trait` ç¤ºä¾‹](https://doc.rust-lang.org/stable/rust-by-example/trait/impl_trait.html)ã€‚

ä½œä¸ºå‚æ•°ç±»åž‹ï¼š

```rust
fn parse_csv_document(src: impl std::io::BufRead) -> std::io::Result<Vec<Vec<String>>> {
    src.lines()
        .map(|line| {
            // For each line in the source
            line.map(|line| {
                // If the line was read successfully, process it, if not, return the error
                line.split(',') // Split the line separated by commas
                    .map(|entry| String::from(entry.trim())) // Remove leading and trailing whitespace
                    .collect() // Collect all strings in a row into a Vec<String>
            })
        })
        .collect() // Collect all lines into a Vec<Vec<String>>
}
```

ä½œä¸ºè¿”å›žå€¼ç±»åž‹ï¼š

```rust
fn double_positives<'a>(numbers: &'a Vec<i32>) -> impl Iterator<Item = i32> + 'a {
    numbers
        .iter()
        .filter(|x| x > &&0)
        .map(|x| x * 2)
}

fn main() {
    let singles = vec![-3, -2, 2, 3];
    let doubles = double_positives(&singles);
    assert_eq!(doubles.collect::<Vec<i32>>(), vec![4, 6]);
}
```
